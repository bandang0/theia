\documentclass{article}


\usepackage{graphicx} % Allows including images
\usepackage{stackengine}
\usepackage{scalerel}
\usepackage{xcolor}
\usepackage{geometry}

\graphicspath{{./img/}}
\renewcommand{\abstractname}{}
\renewcommand{\tt}[1]{\texttt{#1}}

\newcommand\dangersign[1][2ex]{%
  \renewcommand\stacktype{L}%
  \scaleto{\stackon[1.3pt]{\color{red}$\triangle$}{\tiny !}}{#1}%
}

\newcommand{\warn}[1]{\begin{center}
\begin{tabular}{ c  p{12cm} }
\dangersign[22pt] & \vspace{-0.6cm} #1
\end{tabular}
\end{center}}

\geometry{
 a4paper,
 left=30mm,
 right=30mm,
 top=30mm,
 bottom=30mm
 }

\title{\texttt{theia} \\ \quad \\A 3D Gaussian beam tracer \\ \quad \\ \begin{small} Version 0.1.0 \end{small} \\ \quad \\ \textit{User Guide}}

\author{Rapha\"el Duque}

\begin{document}

\maketitle

\begin{abstract}
theia is a command line program and Python library for 3D Gaussian beam tracing. It supports many different types of optical components, general 3D placing and orientation of these components and general astigmatic Gaussian beams, among other features. theia was developed at the Optics Group of the Virgo gravitational observatory in Cascina, Italy. Please see the \tt{README.md} file of \tt{theia} or surf to \tt{http://???.???.???.???} for more information.

This document is a user's guide to the \texttt{theia} command line tool. It gives the information concerning the installation instructions, the usage and the input and output of \texttt{theia} necessary to operate the program from the command line. For details on the \texttt{theia} Python library, please refer to the API Guide provided along with this User Guide.
\end{abstract}


\tableofcontents
\newpage

\section{\texttt{theia} Quick Start}
For a quick start of theia once you are in the project repository, install theia locally with \texttt{make install}. The command \tt{theia} will then be available to you everywhere and  you can run the tutorial input files (with extension \texttt{.tia}) found in the \texttt{tutos/} folder with \texttt{theia FNAME.tia}, replacing \texttt{FNAME.tia} by one of the tutorial files.

The input \tt{.tia} files provide (among other things) the optical setup information in text form. The output \tt{.out} file reports the physical data (waist position relatively to the origin of the beam and waist size) of the beams generated by the propagation of the input beam.

The \tt{alloptics.tia} tutorial file is particularly fit to quickly learn the input format because all the possible types of optics are used in the corresponding simulation. 

\section{Description of theia}
In the section, we will briefly explain the ideas behind the development of theia, describe the way theia sees the physical objects it deals with and tracing algorithm it implements.

\subsection{The theia rationale}
theia has been designed for flexible and practical operation. This why theia is not only a command line tool, but also a Python library aiming at scripting and written accordingly -- please see the theia API Guide for more details on this library. 

The theia command line tool has it its own right been designed with flexibility and pragmatism in mind. The theia input and output files were thought to allow high level features to insure ease of writing and reading by humans, to be printed out, brought to the optical bench and used as references to follow the evolution of the optical layout and its components, to be read as structured files containing figures one can readily compare to experimental data, etc.

Aiming for flexibility also implies liberty for the user when it comes to input. The theia user can specify as much information as she or he wishes. From specifying zero parameters and using default values for all the arguments to using built-in values such as handy units, users have a large radius of action for their input.

With liberty must also come caution. If the user specifies geometrically inconsistent parameters -- leading to self-intersecting surfaces for instance --, then warnings may be issued to standard output (unless specific command line flags are used, see 3.2) but the simulation will carry on almost unseemingly, and may lead to unexpected behavior. 

\subsection{The operation of theia}
theia is a command line 3D Gaussian beam tracing program. During its operation, input beams and an optical setup are read from an input text file and these beams are traced and interact with optical components. Following the rules of geometrical and Gaussian optics, and according to some selection rules designed to insure the termination of the program, this process produces new beams, by reflection and transmission of the former beams on the surfaces of the optical components. This creation and selection process is repeated recursively in order to calculate all the beams produced by the input beams and their geometrical and Gaussian characteristics. 

The beam--reflected beam and beam--transmitted beam relationships are hints that a binary tree is the right way to store the data on beams all along the tracing. And indeed, this is the way data is stored in theia.

\subsection{Beams and optics.}
\subsection{Algorithm and approximations.}

\section{Installation and usage}
\subsection{Installation instructions}
theia uses the Python standard library component \tt{setuptools} to install the command line tool theia as well as the Python library. 

\paragraph{Local installation.}To install theia to your local environment, \tt{cd} to the project repository root and issue the following commands:

\begin{itemize}
\item \tt{make install} to install the theia command line program and library and compile the documentation in the \tt{doc/} sub-directory of the project;
\item \tt{make go} to only install the program and the library but not compile the documentation (useful if you do not have a latex environment running);
\item \tt{make go-doc} to only compile the documentation (useful if you have modified the library to your liking -- please do).
\end{itemize}

\warn{This procedure will install the theia script to \tt{\$HOME/.local/bin}, and this directory \textbf{must} be in your \tt{PATH} in order to have access to theia from anywhere in your file system.}

\paragraph{System-wide installation.}For a system-wide installation, you can issue \tt{python setup.py install} with root privileges from the project root repository. The documentation must be compiled separately as indicated in the former paragraph and moved to some shared directory if you like.

\paragraph{Uninstalling.} Uninstalling a local installation if fairly simple: issue \tt{make clear} from the project root directory. This will wipe your \tt{\$HOME/.local} of anything that has to do with theia. All the documentation, tutorial files or theia input or output files elsewhere will of course stay in place after this procedure.

Uninstalling a system-wide installation is more tricky, and we do not provide an automated procedure for this and admins probably know better than us on this subject, though on most systems \tt{setuptools} puts library files in \tt{/usr/local/lib/python2.7/*-packages} and scripts in \tt{/usr/local/bin}.

\subsection{Usage on the command line}
The general usage of theia is: \tt{theia [options] FNAME}, where:

\begin{itemize}
\item \tt{[options]} are command line options. See the next paragraph or the output of \tt{theia -h} for more details;
\item \tt{FNAME} is the name of the configuration file to use for the simulation, with or without the \tt{.tia} extension. See the next section for details on the format of the \tt{.tia} file.
\end{itemize}

\paragraph{Command line options.}As introduced in section 2. of this User Guide, theia takes one configuration file as an input and may write out to output files and to standard output (the terminal window). The command line options allow the user to control all these outputs. The command line options are summed up in table \ref{option}.


\begin{table}[h]
\begin{center}
\begin{tabular}{| p{4cm} | p{10cm} |}
\hline
\textbf{Command line option} & \textbf{Effect} \\
\hline \hline
\tt{-h, --help} & show the usage and the command line options of theia and exit with a success exit code\\
\hline
\tt{-i, --info} & during the simulation, do not output tracing information to standard output (see section 4.3 for details on the information that is output)\\
\hline
\tt{-w, --no-warn} & during the simulation, do not output warnings to standard output (see section 4.3 to find out what warnings may be written)\\
\hline
\tt{-t, --no-text} & after the simulation, do not write the \tt{.out} text output file (see section 4.2 for details)\\
\hline
\tt{-c, --no-CAD} & after the simulation, do not write the CAD file\\
\hline
\end{tabular}
\end{center}
\label{option}
\caption{Command lines options of theia.}
\end{table}

\section{Input and output to theia}
\subsection{The \tt{.tia} input format}

\subsection{The \tt{.out} output file}



\end{document} 